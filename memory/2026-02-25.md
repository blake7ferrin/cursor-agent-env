# 2026-02-25

- Session: Reviewed repo architecture and bridge setup; identified priorities around bridge state persistence, orchestrator command execution path, security hardening, and basic test/observability additions.
- Session: Implemented bridge hardening: file-backed user->agent store, authenticated `/chat` and `/agent` endpoints with rate limiting, enforced explicit `user_id`, executed parsed `SUBAGENT`/`LOCAL_ACTION` commands with allowlists, and updated bridge/PWA docs for new env vars.
- Session: Added Redis-backed persistence path (`REDIS_URL`) for agent mapping and rate limiting, refactored orchestrator dispatch into a dedicated module, and added Node test coverage for parser + dispatch with passing test run.
- Session: Discussed HVAC estimator-agent architecture; confirmed feasibility of replacing a static pricebook with a dynamic cost/rules engine plus AI intake and CRM/PDF estimate generation.
- Session: Built estimator MVP in bridge: new endpoints for config/catalog/estimate, deterministic pricing engine, printable HTML estimate output, and tests for estimate math + validation.
- Session: Added Housecall Pro CRM integration layer: auth/token handling, Housecall estimate payload mapper, export endpoint with dry-run mode, connector test/debug endpoints, docs updates, and passing tests.
- Session: Extended Housecall export with context-aware modes (`update_estimate`, `add_to_job`, `add_option_note`), appointment-based context resolution, and tests/docs for scheduled-estimate and existing-job workflows.
- Session: Added auto-upsert Housecall export routing (estimate -> appointment context -> job -> create fallback) with fallback attempt tracing and passing test suite.
- Session: Reviewed Bluon API/OpenAPI docs; determined Bluon is highly useful for diagnostics and equipment/parts enrichment, but insufficient as a direct pricing source for estimate totals.
- Session: Added `POST /estimator/changeout-plan` residential intake planner (lane classification, follow-up questions, recommended options, complexity adders, draft estimate preview) plus config/catalog extensions for margin guardrails and equipment attributes.
- Session: Confirmed user can provide full AC Pro/Day & Night pricebooks/manuals; aligned on ingestion strategy for data-plate/photo-driven residential automation with assisted quote mode for non-standard/commercial jobs.
- Session: Updated default estimator assumptions to match user baseline (`$125/hr` all-in labor, `9%` purchase tax, no permit/trip defaults, `40%` target margin, `30%` minimum margin guardrail enabled).
